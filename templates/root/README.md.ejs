# <%= projectName %>

Fullstack application scaffolded with [boiling-fullstack](https://github.com/boiling-fullstack).

## Architecture

- **Backend**: NestJS + TypeORM + PostgreSQL (port <%= backendPort %>)
<%_ for (const fe of frontends) { -%>
- **<%= fe.name %>**: <%= fe.framework === 'nuxt' ? 'Nuxt 4' : 'Vue 3 + Vite' %> (port <%= fe.port %>)
<%_ } -%>
<%_ if (dbAdmin && dbAdmin.tool === 'pgadmin') { -%>
- **Admin DB**: pgAdmin (port <%= dbAdmin.port %>)
<%_ } else if (dbAdmin && dbAdmin.tool === 'adminer') { -%>
- **Admin DB**: Adminer (port <%= dbAdmin.port %>)
<%_ } -%>
- **Database**: PostgreSQL (`<%= dbName %>`, user: `<%= dbUser %>`)

## Getting started

### Prerequisites

- [Docker](https://docs.docker.com/get-docker/) & Docker Compose
- [Node.js](https://nodejs.org/) >= 20 (for local development)

### Start the project (development)

```bash
# Start all services
make up

# View logs
make logs
```

### Available services (development)

| Service | URL |
|---------|-----|
| Backend API | http://localhost:<%= backendPort %> |
| API Docs | http://localhost:<%= backendPort %>/api/docs |
<%_ for (const fe of frontends) { -%>
| <%= fe.name %> | http://localhost:<%= fe.port %> |
<%_ } -%>
<%_ if (dbAdmin && dbAdmin.tool === 'pgadmin') { -%>
| pgAdmin | http://localhost:<%= dbAdmin.port %> |
<%_ } else if (dbAdmin && dbAdmin.tool === 'adminer') { -%>
| Adminer | http://localhost:<%= dbAdmin.port %> |
<%_ } -%>
| PostgreSQL | localhost:5432 |

### API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/` | Status check |
| GET | `/health` | Healthcheck |
| POST | `/auth/register` | Register a new user |
| POST | `/auth/login` | Login |
| POST | `/tasks` | Create a new task (JWT) |
| GET | `/tasks` | List all tasks (JWT) |
| GET | `/tasks/:id` | Get a task by ID (JWT) |
| PATCH | `/tasks/:id` | Update a task (JWT) |
| DELETE | `/tasks/:id` | Delete a task (JWT) |

### API Documentation

Interactive Swagger documentation is available at [http://localhost:<%= backendPort %>/api/docs](http://localhost:<%= backendPort %>/api/docs) when the backend is running.

To test authenticated endpoints in Swagger UI:
1. Call `POST /auth/register` or `POST /auth/login` to get a JWT token
2. Click the **Authorize** button and enter `Bearer <your-token>`
3. All subsequent requests will include the JWT header

### Useful commands (development)

```bash
make up          # Start all services
make down        # Stop all services
make build       # Rebuild all services
make logs        # View all logs
make restart     # Restart all services
make clean       # Stop & remove volumes
```

## Production

### Setup

1. Edit `.env.production` and replace all placeholder values:
   - `DB_PASSWORD` — use a strong, unique password
   - `JWT_SECRET` — generate a random string (min 32 characters)

2. Build and start:

```bash
make build-prod
make up-prod
```

### Commands

```bash
make build-prod    # Build production images
make up-prod       # Start all services (prod)
make down-prod     # Stop all services (prod)
make logs-prod     # View all logs (prod)
make restart-prod  # Restart all services (prod)
make clean-prod    # Stop & remove volumes (prod)
```

### Dev vs Production comparison

| Aspect | Development | Production |
|--------|-------------|------------|
| Compose file | `docker-compose.yml` | `docker-compose.prod.yml` |
| Env file | `.env` | `.env.production` |
| Build target | `development` | `production` |
| Restart policy | `unless-stopped` | `always` |
| Source volumes | Mounted (hot-reload) | None (code built in image) |
| Backend NODE_ENV | `development` | `production` |
<%_ for (const fe of frontends) { -%>
<%_ if (fe.framework === 'vue') { -%>
| <%= fe.name %> server | Vite dev (port 5173) | nginx (port 80) |
<%_ } else { -%>
| <%= fe.name %> server | Nuxt dev (port 3000) | Nuxt production (port 3000) |
<%_ } -%>
<%_ } -%>
| PostgreSQL | Exposed (5432) | Internal only |
<%_ if (dbAdmin) { -%>
| DB Admin | <%= dbAdmin.tool === 'pgadmin' ? 'pgAdmin' : 'Adminer' %> | Not included |
<%_ } -%>

## Migrations

TypeORM migrations are used to manage the database schema in production. In development, `synchronize: true` handles schema changes automatically.

### Workflow

1. **Generate** a migration after modifying entities:

```bash
make migration-generate name=AddPostTable
```

2. **Review** the generated file in `backend/src/migrations/`.

3. **Run** the migration:

```bash
# Development
make migration-run

# Production
make migration-run-prod
```

### Commands

| Command | Description |
|---------|-------------|
| `make migration-generate name=Name` | Generate a migration from entity changes |
| `make migration-run` | Run pending migrations (dev) |
| `make migration-revert` | Revert last migration (dev) |
| `make migration-run-prod` | Run pending migrations (prod) |

## Environment variables

Configuration is managed via two env files at the project root:

- **`.env`** — Development environment. Used by `docker-compose.yml`.
- **`.env.production`** — Production environment. Used by `docker-compose.prod.yml`. Contains placeholder values that **must** be changed before deploying.

Both files are listed in `.gitignore` and should never be committed.
