.PHONY: up down build logs restart clean up-prod down-prod build-prod logs-prod restart-prod clean-prod db-logs db-shell lint-back format-back<%_ if (dbAdmin && dbAdmin.tool === 'pgadmin') { %> pgadmin-logs pgadmin-restart<%_ } else if (dbAdmin && dbAdmin.tool === 'adminer') { %> adminer-logs adminer-restart<%_ } %>

# --- Development ---

# Start all services (dev)
up:
	docker compose up -d

# Stop all services (dev)
down:
	docker compose down

# Build all services (dev)
build:
	docker compose build

# View logs (dev)
logs:
	docker compose logs -f

# Restart all services (dev)
restart:
	docker compose restart

# Clean everything (dev, volumes included)
clean:
	docker compose down -v

# --- Production ---

# Start all services (prod)
up-prod:
	docker compose -f docker-compose.prod.yml --env-file .env.production up -d

# Stop all services (prod)
down-prod:
	docker compose -f docker-compose.prod.yml --env-file .env.production down

# Build all services (prod)
build-prod:
	docker compose -f docker-compose.prod.yml --env-file .env.production build

# View logs (prod)
logs-prod:
	docker compose -f docker-compose.prod.yml --env-file .env.production logs -f

# Restart all services (prod)
restart-prod:
	docker compose -f docker-compose.prod.yml --env-file .env.production restart

# Clean everything (prod, volumes included)
clean-prod:
	docker compose -f docker-compose.prod.yml --env-file .env.production down -v

# --- Service commands ---

# Database commands
db-logs:
	docker compose logs -f postgres

db-shell:
	docker compose exec postgres psql -U <%= dbUser %> -d <%= dbName %>

# Backend commands
backend-logs:
	docker compose logs -f backend

backend-shell:
	docker compose exec backend sh

lint-back:
	docker compose exec backend npm run lint

format-back:
	docker compose exec backend npm run format
<%_ for (const fe of frontends) { %>
# <%= fe.name %> commands
<%= fe.name %>-logs:
	docker compose logs -f <%= fe.name %>

<%= fe.name %>-shell:
	docker compose exec <%= fe.name %> sh
<%_ } %>
<%_ if (dbAdmin && dbAdmin.tool === 'pgadmin') { %>
# pgAdmin commands
pgadmin-logs:
	docker compose logs -f pgadmin

pgadmin-restart:
	docker compose restart pgadmin
<%_ } else if (dbAdmin && dbAdmin.tool === 'adminer') { %>
# Adminer commands
adminer-logs:
	docker compose logs -f adminer

adminer-restart:
	docker compose restart adminer
<%_ } %>
