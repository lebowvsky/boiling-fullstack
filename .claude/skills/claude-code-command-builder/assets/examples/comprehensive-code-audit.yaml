---
name: comprehensive-code-audit
description: Perform a comprehensive code audit with security, performance, and quality checks
created: 2024-01-15T10:00:00
---

# Command: Comprehensive Code Audit

## Description
Performs a multi-faceted code audit including security analysis, performance review, code quality assessment, and generates an actionable improvement plan.

## Parameters
parameters:
  - name: target_directory
    type: string
    required: true
    description: Directory to audit (e.g., src/components, src/services)
    
  - name: audit_type
    type: string
    required: false
    description: Type of audit (full, security, performance, quality)
    default: "full"
    
  - name: severity_threshold
    type: string
    required: false
    description: Minimum severity to report (low, medium, high, critical)
    default: "medium"

## Workflow
workflow:
  # Step 1: Scan and catalog files
  - step: scan_codebase
    agent: file-scanner
    description: Scan directory and identify files to audit
    prompt: |
      Scan the directory {{target_directory}} and identify all code files.
      
      Focus on:
      - .vue, .ts, .js files
      - Identify critical vs non-critical files
      - Note file sizes and complexity
      
      Create a structured catalog for auditing.
    output_variable: file_catalog
    on_error: stop
    
  # Step 2: Security audit
  - step: security_audit
    agent: security-auditor
    description: Analyze code for security vulnerabilities
    condition: "audit_type equals 'full' OR audit_type equals 'security'"
    prompt: |
      Perform security audit on these files:
      {{file_catalog}}
      
      Check for:
      - XSS vulnerabilities
      - SQL injection risks
      - Insecure data handling
      - Exposed secrets or API keys
      - Authentication/authorization issues
      - CSRF vulnerabilities
      
      Minimum severity: {{severity_threshold}}
    output_variable: security_report
    on_error: continue
    retry_count: 2
    
  # Step 3: Performance audit
  - step: performance_audit
    agent: performance-analyzer
    description: Analyze code for performance issues
    condition: "audit_type equals 'full' OR audit_type equals 'performance'"
    prompt: |
      Analyze performance of these files:
      {{file_catalog}}
      
      Check for:
      - Memory leaks
      - Inefficient algorithms
      - Unnecessary re-renders (Vue)
      - Large bundle sizes
      - Blocking operations
      - Missing lazy loading
      
      Minimum severity: {{severity_threshold}}
    output_variable: performance_report
    on_error: continue
    
  # Step 4: Code quality audit
  - step: quality_audit
    agent: code-reviewer
    description: Assess overall code quality
    condition: "audit_type equals 'full' OR audit_type equals 'quality'"
    prompt: |
      Review code quality for these files:
      {{file_catalog}}
      
      Assess:
      - Code maintainability
      - Design patterns usage
      - TypeScript coverage
      - Code duplication
      - Naming conventions
      - Documentation quality
      - Test coverage
      
      Minimum severity: {{severity_threshold}}
    output_variable: quality_report
    on_error: continue
    
  # Step 5: Synthesize findings
  - step: synthesize_findings
    agent: report-synthesizer
    description: Combine all audit results into coherent report
    prompt: |
      Synthesize these audit results into a comprehensive report:
      
      File Catalog:
      {{file_catalog}}
      
      {{#if security_report}}
      Security Findings:
      {{security_report}}
      {{/if}}
      
      {{#if performance_report}}
      Performance Findings:
      {{performance_report}}
      {{/if}}
      
      {{#if quality_report}}
      Quality Findings:
      {{quality_report}}
      {{/if}}
      
      Create an executive summary with:
      - Total issues by severity
      - Top 5 critical issues
      - Overall risk score
      - Quick wins for improvement
    output_variable: executive_summary
    on_error: stop
    
  # Step 6: Generate action plan
  - step: create_action_plan
    agent: project-planner
    description: Create prioritized improvement roadmap
    prompt: |
      Based on this audit summary, create an actionable improvement plan:
      {{executive_summary}}
      
      Include:
      - Prioritized list of fixes (by severity and effort)
      - Estimated time for each fix
      - Dependencies between fixes
      - Suggested order of implementation
      - Team assignments recommendations
    output_variable: action_plan
    on_error: continue
    
  # Step 7: Generate tickets (optional)
  - step: generate_tickets
    agent: ticket-generator
    description: Generate issue tickets for critical findings
    condition: "executive_summary contains 'critical'"
    prompt: |
      Generate issue tickets for critical findings:
      {{executive_summary}}
      
      For each critical issue, create:
      - Title
      - Description
      - Steps to reproduce
      - Suggested fix
      - Labels (security/performance/quality)
      - Priority
    output_variable: generated_tickets
    on_error: continue

## Output Configuration
output:
  format: markdown
  variables:
    - executive_summary
    - action_plan
    - security_report
    - performance_report
    - quality_report
    - generated_tickets
  save_to: .claude/audits/audit-{{target_directory}}-{{timestamp}}.md

## Usage Examples

### Full audit of components directory:
```bash
python scripts/execute_workflow.py .claude/commands/comprehensive-code-audit.yaml \
  --param target_directory=src/components \
  --param audit_type=full \
  --param severity_threshold=medium
```

### Security-focused audit:
```bash
python scripts/execute_workflow.py .claude/commands/comprehensive-code-audit.yaml \
  --param target_directory=src/services \
  --param audit_type=security \
  --param severity_threshold=low
```

### Quick quality check:
```bash
python scripts/execute_workflow.py .claude/commands/comprehensive-code-audit.yaml \
  --param target_directory=src/utils \
  --param audit_type=quality \
  --param severity_threshold=high
```

## Expected Output

The command generates a comprehensive audit report with:
- Executive summary with key metrics
- Detailed findings by category
- Prioritized action plan
- Auto-generated tickets for critical issues

## Notes
- Requires multiple specialized agents (security, performance, quality)
- Large codebases may take 10-20 minutes
- Results are saved in `.claude/audits/` directory
- Manual verification of critical findings is recommended
- Some audit steps use `continue` on error to ensure partial results
